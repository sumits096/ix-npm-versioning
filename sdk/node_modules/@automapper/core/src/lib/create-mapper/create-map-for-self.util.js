"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createMapForSelf = void 0;
const utils_1 = require("../utils");
/**
 *
 * @param {Mapping} mapping - Mapping between source <> destination
 * @param {TSource} source - the Source model to map to self
 * @param {Selector<TSource>} selector - the selector to use to get the property that contains the source
 */
function createMapForSelf(mapping, source, selector) {
    const mapper = mapping[4 /* mapper */];
    const [, destinationInstance] = mapping[0 /* mappings */];
    const [sourceInstance] = mapper.plugin.instantiate(source);
    const sourceInstanceKeys = Object.keys(sourceInstance);
    for (let i = 0, keysLen = sourceInstanceKeys.length; i < keysLen; i++) {
        const key = sourceInstanceKeys[i];
        const foundMapProperty = mapping[2 /* properties */].find((property) => property[0 /* path */].indexOf(key) === 0);
        if (!foundMapProperty) {
            if (!(key in destinationInstance))
                continue;
            mapping[2 /* properties */].push([
                [key],
                [
                    [[key]],
                    [
                        [
                            6 /* MapInitialize */,
                            (originalSource) => (0, utils_1.get)(selector(originalSource), [key]),
                        ],
                        false,
                    ],
                ],
            ]);
            continue;
        }
        if (foundMapProperty[1 /* property */][1 /* transformation */][0 /* memberMapFn */][0 /* type */] !==
            6 /* MapInitialize */)
            continue;
        foundMapProperty[1 /* property */][1 /* transformation */][0 /* memberMapFn */] = [
            6 /* MapInitialize */,
            (originalSource) => (0, utils_1.get)(selector(originalSource), [key]),
        ];
    }
}
exports.createMapForSelf = createMapForSelf;
//# sourceMappingURL=create-map-for-self.util.js.map