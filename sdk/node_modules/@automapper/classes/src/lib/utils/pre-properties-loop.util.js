"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.prePropertiesLoop = void 0;
const instantiate_util_1 = require("./instantiate.util");
function prePropertiesLoop(source, metadataStorage, instanceStorage, sourceInstance, sourceNestedConstructible) {
    return (mapping) => {
        // get prototype of the constructor
        const sourceProtoConstructor = Object.getPrototypeOf(source.constructor);
        // if it has name, then it's not anonymous Function
        if (sourceProtoConstructor.name) {
            // try to instantiate the proto constructor
            const [sourceProtoInstance, sourceProtoNestedConstructible] = (0, instantiate_util_1.instantiate)(instanceStorage, metadataStorage, sourceProtoConstructor);
            // merge the instance of the proto with the sourceInstance
            sourceInstance = Object.assign(sourceInstance, sourceProtoInstance);
            // update the sourceInstance on the mapping
            mapping[0 /* mappings */][0] = sourceInstance;
            if (sourceProtoNestedConstructible.length) {
                // update the nested constructible
                sourceNestedConstructible = sourceNestedConstructible.concat(sourceProtoNestedConstructible);
            }
        }
    };
}
exports.prePropertiesLoop = prePropertiesLoop;
//# sourceMappingURL=pre-properties-loop.util.js.map